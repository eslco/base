// Build: 2024/11/10 17:24:07
(()=>{var l=class{constructor(e,t,s){this._times=new Map,this.name=e??"",this.debug=s?.debug??!1,e&&this.log(`${e} Start`),this.className=t??"",this.init()}static getInstance(e,t){let s=typeof $task<"u"?"QuanX":"Surge";return l.instances[s]||(l.instances[s]=l.classNames[s](e,s,t)),l.instances[s]}createProxy(e){return new Proxy(e,{get:this.getFn,set:this.setFn})}getFn(e,t,s){return e[t]}setFn(e,t,s,n){return e[t]=s,!0}getJSON(e,t={}){let s=this.getVal(e);return s?JSON.parse(s):t}setJSON(e,t){this.setVal(JSON.stringify(e),t)}msg(e=this.name,t="",s="",n){}log(e){this.debug&&(typeof e=="object"&&(e=JSON.stringify(e)),console.log(e))}timeStart(e){this._times.set(e,Date.now())}timeEnd(e){if(this._times?.has(e)){let t=Date.now()-this._times.get(e);this.log(`${e}: ${t}ms`),this._times.delete(e)}else this.log(`Timer with label ${e} does not exist.`)}exit(){$done({})}reject(){$done()}};l.instances={};l.classNames={QuanX:(r,e,t)=>new c(r,e,t),Surge:(r,e,t)=>new p(r,e,t)};var p=class extends l{getFn(e,t,s){let n=p.clientAdapter[t]||t;return super.getFn(e,n,s)}setFn(e,t,s,n){let i=p.clientAdapter[t]||t;return super.setFn(e,i,s,n)}init(){try{this.request=this.createProxy($request),this.response=this.createProxy($response)}catch(e){this.log(e.toString())}}getVal(e){return $persistentStore.read(e)}setVal(e,t){$persistentStore.write(e,t)}msg(e=this.name,t="",s="",n){$notification.post(e,t,s,{url:n??""})}async fetch(e){return await new Promise((t,s)=>{let{method:n,body:i,bodyBytes:o,...u}=e,d=o??i,f=d instanceof Uint8Array;$httpClient[n.toLowerCase()]({...u,body:d,"binary-mode":f},(g,m,S)=>{g&&s(g);let F=f?"bodyBytes":"body";t({status:m.status||m.statusCode,headers:m.headers,[F]:S})})})}done(e){let t=e.response??e,s,n;t.bodyBytes?(s=t.bodyBytes,delete t.bodyBytes,n={...e},n.response?n.response.body=s:n.body=s):n=e,$done(n)}};p.clientAdapter={bodyBytes:"body"};var c=class extends l{static transferBodyBytes(e,t){return e instanceof ArrayBuffer?t==="Uint8Array"?new Uint8Array(e):e:e instanceof Uint8Array&&t==="ArrayBuffer"?e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset):e}init(){try{this.request=this.createProxy($request),this.response=this.createProxy($response)}catch(e){this.log(e.toString())}}getFn(e,t,s){let n=c.clientAdapter[t]||t,i=super.getFn(e,n,s);return t==="bodyBytes"&&(i=c.transferBodyBytes(i,"Uint8Array")),i}setFn(e,t,s,n){let i=c.clientAdapter[t]||t,o=s;return t==="bodyBytes"&&(o=c.transferBodyBytes(o,"Uint8Array")),super.setFn(e,i,o,n)}getVal(e){return $prefs.valueForKey(e)?.replace(/\0/g,"")}setVal(e,t){$prefs.setValueForKey(e,t)}msg(e=this.name,t="",s="",n){$notify(e,t,s,{"open-url":n??""})}async fetch(e){return await new Promise(t=>{let s={url:"",method:"GET"};for(let[n,i]of Object.entries(e))n==="id"?s.sessionIndex=i:n==="bodyBytes"?s.bodyBytes=c.transferBodyBytes(i,"ArrayBuffer"):s[n]=i;e.bodyBytes&&delete s.body,$task.fetch(s).then(n=>{let i={status:200,headers:{}};for(let[o,u]of Object.entries(n))o==="sessionIndex"?i.id=u:o==="bodyBytes"?i.bodyBytes=c.transferBodyBytes(u,"Uint8Array"):o==="statusCode"?i.status=u:i[o]=u;t(i)})})}done(e){let t=e.response??e,s={};for(let[n,i]of Object.entries(t))n==="status"?s.status=`HTTP/1.1 ${i}`:n==="bodyBytes"?s.bodyBytes=c.transferBodyBytes(i,"ArrayBuffer"):s[n]=i;$done(s)}};c.clientAdapter={id:"sessionIndex",status:"statusCode"};var a=$=l.getInstance("X-Rss",{debug:!1});var h={ProfileSpotlightsQuery:{url:"https://x.com/i/api/graphql/-0XdHI-mrHWBQd8-oLo1aA/ProfileSpotlightsQuery",variables:{screen_name:null}},UserTweets:{url:"https://x.com/i/api/graphql/Tg82Ez_kxVaJf7OPbUdbCg/UserTweets",variables:{userId:null,count:30,includePromotedContent:!1,withQuickPromoteEligibilityTweetFields:!1,withVoice:!1,withV2Timeline:!0},features:{rweb_tipjar_consumption_enabled:!0,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,creator_subscriptions_tweet_preview_api_enabled:!0,responsive_web_graphql_timeline_navigation_enabled:!0,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,communities_web_enable_tweet_community_results_fetch:!0,c9s_tweet_anatomy_moderator_badge_enabled:!0,articles_preview_enabled:!0,responsive_web_edit_tweet_api_enabled:!0,graphql_is_translatable_rweb_tweet_is_translatable_enabled:!0,view_counts_everywhere_api_enabled:!0,longform_notetweets_consumption_enabled:!0,responsive_web_twitter_article_tweet_consumption_enabled:!0,tweet_awards_web_tipping_enabled:!1,creator_subscriptions_quote_tweet_preview_enabled:!1,freedom_of_speech_not_reach_fetch_enabled:!0,standardized_nudges_misinfo:!0,tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled:!0,rweb_video_timestamps_enabled:!0,longform_notetweets_rich_text_read_enabled:!0,longform_notetweets_inline_media_enabled:!0,responsive_web_enhance_cards_enabled:!1}},PinnedTimelines:{url:"https://x.com/i/api/graphql/C-IBapfouIWLa8v6GcGATQ/PinnedTimelines",variables:"%7B%7D",features:{rweb_tipjar_consumption_enabled:!0,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,responsive_web_graphql_timeline_navigation_enabled:!0}},ListLatestTweetsTimeline:{url:"https://x.com/i/api/graphql/f-Lsj0rHCztXcgdo585UUw/ListLatestTweetsTimeline",variables:{listId:null,count:40},features:{rweb_tipjar_consumption_enabled:!0,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,creator_subscriptions_tweet_preview_api_enabled:!0,responsive_web_graphql_timeline_navigation_enabled:!0,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,communities_web_enable_tweet_community_results_fetch:!0,c9s_tweet_anatomy_moderator_badge_enabled:!0,articles_preview_enabled:!0,responsive_web_edit_tweet_api_enabled:!0,graphql_is_translatable_rweb_tweet_is_translatable_enabled:!0,view_counts_everywhere_api_enabled:!0,longform_notetweets_consumption_enabled:!0,responsive_web_twitter_article_tweet_consumption_enabled:!0,tweet_awards_web_tipping_enabled:!1,creator_subscriptions_quote_tweet_preview_enabled:!1,freedom_of_speech_not_reach_fetch_enabled:!0,standardized_nudges_misinfo:!0,tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled:!0,rweb_video_timestamps_enabled:!0,longform_notetweets_rich_text_read_enabled:!0,longform_notetweets_inline_media_enabled:!0,responsive_web_enhance_cards_enabled:!1}}},B={"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 16_7_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1"};var L=/(?<scheme>.+):\/\/(?<host>[^/]+)\/?(?<path>[^?]+)?\??(?<params>.*)?/,w=class{constructor(e=""){if(this.name="URL v1.0.2",!e)throw new Error("Empty URL");this.parse(e)}parse(e){let{scheme:t,host:s,path:n="",params:i}=e.match(L)?.groups??{};this.scheme=t,this.host=s,this.path=n,this.params=i?i.split("&").reduce((o,u)=>{let[d,f]=u.split("=");return o[d]=f,o},{}):{}}toString(){let e=this.scheme+"://"+this.host+"/"+this.path;return this.params&&(e+="?"+Object.entries(this.params).reduce((t,[s,n],i)=>t+(i?"&":"")+s+"="+n,"")),e}};async function b(r,e,t){let s=new w(r);typeof e=="object"&&(e=JSON.stringify(e)),typeof t=="object"&&(t=JSON.stringify(t)),e&&(s.params.variables=e),t&&(s.params.features=t);let{auth:n,refreshToken:i,cookie:o}=a.getJSON("S-RSS-ACCOUNT");n&&i&&o||(a.msg("S-RSS","\u65E0\u53EF\u7528\u8D26\u6237\u4FE1\u606F","\u4F7F\u7528\u6D4F\u89C8\u5668\u767B\u5F55X\u83B7\u53D6"),a.done({response:{}}));let u=await a.fetch({url:s.toString(),method:"GET",headers:{...B,authorization:n,cookie:o,"x-csrf-token":i}});return u.status!==200&&_("\u83B7\u53D6X\u6570\u636E\u9519\u8BEF","\u53EF\u80FD\u9700\u8981\u91CD\u65B0\u83B7\u53D6\u8D26\u6237\u4FE1\u606F"),JSON.parse(u.body)}function I(r){return r.data.user_result_by_screen_name.result.rest_id}function A(r,e){let t=r.data.pinned_timelines.pinned_timelines;for(let s of t)if(s.__typename==="ListPinnedTimeline"&&s.list.name===e)return s.list.id_str}function T(r){let e=r.find(s=>s.type==="TimelineAddEntries"),t=[];for(let s of e.entries){let n={items:[]};s.entryId.startsWith("profile-conversation-")?n.items=D(s.content.items):s.entryId.startsWith("tweet-")&&n.items.push(x(s.content.itemContent.tweet_results.result)),n.items.length!==0&&t.push(n)}return t}function v(r,e){let t=Object.keys(r).find(s=>s.toLowerCase()===e.toLowerCase());return r[t]}function D(r){let e=[];for(let t of r){let s=x(t.item.itemContent.tweet_results.result);e.push(s)}return e}function x(r){let e={};if(e.user=C(r),e.tweet=j(r),r?.quoted_status_result?.result){let t=r.quoted_status_result.result;e.quoted=x(t)}if(r?.legacy?.retweeted_status_result?.result){let t=r.legacy.retweeted_status_result.result;e.reTweet=x(t)}return e}function C(r){let e=r.core.user_results.result.legacy;return{name:e.name,screenName:e.screen_name,avatar:e.profile_image_url_https}}function j(r){let e=r.legacy,t=r?.note_tweet?.note_tweet_results?.result,s={tweetId:r.rest_id,legacy:{text:e.full_text,urls:e?.entities?.urls?.map(n=>({url:n.expanded_url,display:n.display_url,shortUrl:n.url}))},media:e?.entities?.media?.map(n=>({type:n.type,url:n.media_url_https,shortUrl:n.url,videoUrl:n?.video_info?.variants?.[0]?.url})),createDate:e.created_at};return t&&(s.noteTweet={text:t.text,urls:t?.entity_set?.urls?.map(n=>({url:n.expanded_url,display:n.display_url,shortUrl:n.url}))}),s}function _(r,e){(r||e)&&a.msg("S-RSS",r||"",e||""),a.done({response:{}})}function q(r){a.done({response:{body:r,headers:{"Content-Type":"application/rss+xml; charset=UTF-8"}}})}async function J(r){let e=a.getJSON("S-RSS",{users:{},list:{}}),t=e.users[r];if(!t){let s=h.ProfileSpotlightsQuery;s.variables.screen_name=r;let n=await b(s.url,s.variables);t=I(n),t||_(`\u672A\u627E\u5230\u7528\u6237:${r}`),e.users[r]=t,a.setJSON(e,"S-RSS")}return t}async function E(r){let e=a.getJSON("S-RSS",{users:{},list:{}}),t=e.list[r];if(!t){let s=h.PinnedTimelines,n=await b(s.url,null,s.features);t=A(n,r),t||_(`\u8BE5\u8D26\u6237\u4FE1\u606F\u672A\u627E\u5230\u5217\u8868:${r}`),e.list[r]=t,a.setJSON(e,"S-RSS")}return t}async function P(r){let e=await J(r);a.log(e);let t=h.UserTweets;t.variables.userId=e;let s=await b(t.url,t.variables,t.features);return T(s.data.user.result.timeline_v2.timeline.instructions)}async function R(r){let e=await E(r),t=h.ListLatestTweetsTimeline;t.variables.listId=e;let s=await b(t.url,t.variables,t.features);return T(s.data.list.tweets_timeline.timeline.instructions)}function U(r,e,t,s){let n=[];for(let i of s){let{name:o,screenName:u,tweetId:d,description:f,pubDate:g}=H(i.items[0]),m=V(i.items),S=`<item>
                                   <title>${o}</title>
                                   <link>https://x.com/${u}/status/${d}</link>
                                   <description>${f}</description>
                                   <content:encoded>
                                        <![CDATA[${m}]]>
                                   </content:encoded>
                                   <pubDate>${g}</pubDate>
                             </item>`;n.push(S)}return W(r,e,t,n)}function V(r){let e="",t=0;for(let s of r)N(t)&&(e+="<hr>"),s.reTweet?(e+=`<strong>RT</strong>${k(s.reTweet)}`,s=s.reTweet):e+=k(s,N(t)),s.quoted&&(e+=`<blockquote>${k(s.quoted)}</blockquote>`),t++;return e}function k(r,e=!0){let t=r.tweet.legacy;r.tweet.noteTweet&&(t=r.tweet.noteTweet);let s="";if(e){let n=`https://x.com/${r.user.screenName}/status/${r.tweet.tweetId}`,i=new Date(r.tweet.createDate),o=`${i.getFullYear()}\u5E74${i.getMonth()+1}\u6708${i.getDate()}\u65E5`;s+=`<H4><a href="${n}">${r.user.name}</H4>`,s+=`<strong>${o}</strong>`}return s+=`<p>${t.text}</p>`.replace(/\n/g,"<br>"),t?.urls?.map(n=>{s=O(s,n.shortUrl,`<a href="${n.url}">${n.display}</a>`)}),r?.tweet?.media?.map(n=>{let i=`<img alt="" src="${n.url}"/>`;n.type==="video"&&(i=`<video muted src="${n.videoUrl}" poster="${n.url}"></video>`),s=O(s,n.shortUrl,i)}),s}function O(r,e,t){let s=r.replace(e,t);return s===r?r+=t:r=s,r}function N(r){return r!==0}function H(r){return{name:r.user.name,screenName:r.user.screenName,tweetId:r.tweet.tweetId,description:r.tweet.legacy.text,pubDate:new Date(r.tweet.createDate).toUTCString()}}function W(r,e,t,s){let n=new Date().toUTCString();return`<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
                    <channel>
                        <title>${r}</title>
                        <link>${e}</link>
                        <description>\u89E3\u6790X\u751F\u6210RSS\u8BA2\u9605</description>
                        <pubDate>${n}</pubDate>
                        <lastBuildDate>${n}</lastBuildDate>
                        <atom:link href="${t}" rel="self" type="application/rss+xml"/>
                        ${s.join(`
`)}
                    </channel>
            </rss>`}var y=a.request.url;if(y.startsWith("https://api.x.com/1.1/account/settings.json")){let r=a.request.headers,e=v(r,"authorization"),t=v(r,"x-csrf-token"),s=v(r,"cookie"),n={auth:e,refreshToken:t,cookie:s};a.setJSON(n,"S-RSS-ACCOUNT"),a.msg("S-RSS","X\u8D26\u6237\u4FE1\u606F\u83B7\u53D6\u6210\u529F"),a.exit()}else if(y.startsWith("http://s.rss/x/user/")){let r=y.split("/"),e=r[r.length-1];e.startsWith("@")||_("RSS\u94FE\u63A5\u9519\u8BEF","\u53C2\u8003\u6A21\u677Fhttp://s.rss/x/user/@username");let t=e.substring(1);P(t).then(s=>{let n=U(t,`https://x.com/${t}`,`http://s.rss/x/user/${t}`,s);q(n)}).catch(s=>{console.log(s)}).finally(()=>{_()})}else if(y.startsWith("http://s.rss/x/list/")){let r=y.split("/"),e=r[r.length-1];R(e).then(t=>{let s=U(e,"https://x.com/home",`http://s.rss/x/list/${e}`,t);q(s)}).catch(t=>{console.log(t)}).finally(()=>{_()})}else _();})();
